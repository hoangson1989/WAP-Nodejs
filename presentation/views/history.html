<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
		<link rel="stylesheet" href="../css/login.css" />
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
		<style>
			#backButton {
				position: absolute;
				bottom: 150px; /* Adjust the distance from the bottom as needed */
				left: 50%; /* Place it at 50% from the left */
				transform: translateX(-50%); /* Center it horizontally */
			}
			#history {
				max-height: 600px; /* Set maximum height to limit the size of the ranking area */
				padding: 20px;
				border-radius: 10%;
				border: 2px solid yellow; /* Yellow solid border */
				position: absolute; /* Position the ranking div absolutely */
				top: 50%; /* Place it at 50% from the top */
				left: 50%; /* Place it at 50% from the left */
				transform: translate(
					-50%,
					-50%
				); /* Center it both vertically and horizontally */
				z-index: 99;
			}
			table {
				width: 100%;
				border-collapse: collapse;
			}

			th,
			td {
				padding: 8px;
				text-align: center;
				border-bottom: 1px solid #ddd;
                color: white;
                font-weight: bold;
			}

			th {
				background-color: #8d98ed;
			}
			.score {
				border-radius: 10px; /* Update border-radius for rounded corners */
				margin-bottom: 10px;
				padding: 10px;
				text-align: center;
				color: black; /* Text color */
				font-weight: bold; /* Bold text font */
				background-color: #c7e9c7; /* Grey background color */
			}
		</style>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
		<script>
			$(document).ready(function () {
				// const username = getCookie("username"); // Get the username from the cookie
				const username = getCookie("username");
				if (username) {
					$("#historyTitle").text(`Playing history of ${username}`);
				}
				if (username) {
					$.getJSON("./database/users.json", function (data) {
						const user = data.find((u) => u.username === username);
						if (username) {
							$.getJSON("./database/users.json", function (data) {
								const user = data.find((u) => u.username === username);
								if (user) {
									// Sort the history array by date in descending order
									user.history.sort(
										(a, b) => new Date(b.dateTime) - new Date(a.dateTime)
									);

									// Select only the last 10 entries from the history array
									const last10Entries = user.history.slice(0, 10);

									// Display the history data as a table
									const table = $("<table></table>");
									const tableHeader = $("<tr></tr>").append(
										$("<th>Date</th>"),
										$("<th>Score</th>")
									);
									table.append(tableHeader);
									last10Entries.forEach((entry) => {
										const row = $("<tr></tr>").append(
											$("<td></td>").text(entry.dateTime),
											$("<td></td>").text(entry.score)
										);
										table.append(row);
									});
									$("#history").append(table);
								} else {
									console.log("User not found");
								}
							});
						} else {
							console.log("Username cookie not found");
						}
					});
				} else {
					console.log("Username cookie not found");
				}

				// Function to get cookie value by name
				function getCookie(name) {
					const cookies = document.cookie.split(";");
					for (let cookie of cookies) {
						const [cookieName, cookieValue] = cookie.split("=");
						if (cookieName.trim() === name) {
							return cookieValue;
						}
					}
					return null;
				}
			});
		</script>
	</head>

	<body style="padding: 0px; margin: 0px">
		<div style="position: relative">
			<img id="bg" src="/images/millionaire01.jpg" />
			<img
				id="icon"
				style="position: absolute"
				src="/images/who-wants-to-be-a-millionaire-2014-millionaire-2017-game-show-quiz-android-thumbnail.png"
			/>
			<div id="history">
				<h1
					id="historyTitle"
					style="color: greenyellow; text-align: center; margin-bottom: 20px"
				></h1>
			</div>
			<div id="backButton">
				<a href="/profile"><button>Back to Profile</button></a>
			</div>
		</div>
	</body>
</html>
